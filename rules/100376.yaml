# Built-in administrator account login detected
field_order: ["source", "target", "username", "login_type"]

extract_rules:
  source: "data.win.eventdata.ipAddress"
  target: "data.win.eventdata.workstationName"
  username: "data.win.eventdata.targetUserName"
  login_type: "data.win.eventdata.logonType"

notification_extract_rules:
  source_ip: "data.win.eventdata.ipAddress"
  target_host: "data.win.system.computer"
  username: "data.win.eventdata.targetUserName"
  login_type: "data.win.eventdata.logonType"
  login_process: "data.win.eventdata.processName"
  domain: "data.win.eventdata.targetDomainName"

fir:
  subject: "Built-in admin login: {username}@{domain} to {target_host} from {source_ip}"
  
  description_template: |
    ## Built-in Administrator Account Login Detected
    **Time:** {timestamp}
    **Alert ID:** {alert_id}
    
    **Target Host:** {target_host}
    **Source IP:** {source_ip}
    **Username:** {username}@{domain}
    **Logon Type:** {login_type}
    **Logon Process:** {login_process}
    
    ### Investigation Context
    Use of built-in administrator accounts (Administrator, SYSTEM, etc.) is often:
    - Normal for initial system setup/maintenance
    - Suspicious in daily operations
    - Common in lateral movement attacks
    - Used by malware for privilege escalation
        
    ### Investigation Steps
    1. **Legitimacy verification:** Check if this was scheduled maintenance.
    2. **Source analysis:** Verify if {source_ip} is expected management host.
    3. **Authentication method:** Check if NTLM/Kerberos was used.
    4. **Post-login activity:** Review subsequent events on {target_host}.
    5. **Account usage patterns:** Check frequency of built-in admin logins.
    
  severity: 1
  category: "Suspicious Authentication"